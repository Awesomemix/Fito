<!Doctype html>
<html>
<head>
<meta charset="UTF-8">
<script src="../js/web3.min.js"></script>
<script src="../../build/contracts/GeneralMeeting.js"></script>
<script type="text/javascript">

    console.log('starting...');
    //connect web3 and check if web3 is connected correctly
    if (typeof web3 !== 'undefined') {
        web3 = new Web3(web3.currentProvider);
    } else {
        // set the provider you want from Web3.providers
        web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:7545"));
    }

    if (web3.isConnected()) {
        console.log("connected");
    } else {
        console.log("not connected")
    }

    // var abi = TestContract_build.abi;
    // var contractAddress = "0xa8a4665904d6909b3ca5d43238d59ef3cba6e17d";
    var abi = GeneralMeeting_build.abi;
    var contractAddress = "<배포한 CA 주소>";

    console.log('abi', abi);
    var vc = web3.eth.contract(abi).at(contractAddress);
    console.log('vc', vc);

    function getBalance() {
            var address, wei, balance
            address = web3.eth.accounts[ 0 ];
            try {
                web3.eth.getBalance(address, function (error, wei) {
                    if (!error) {
                        var balance = web3.fromWei(wei, 'ether');
                        document.getElementById("getBalance").innerHTML = balance + " ETH ," + wei + " wei";
                    }
                });
            } catch (err) {
                document.getElementById("getBalance").innerHTML = err;
            }
      }

    function getTotalStuck() {
        try {
            console.log("임의의 주소", "<임의의 주소>");
            var addressTotalToken = vc.getTotalStuck("<임의의 주소>");
            console.log('addressTotalToken', addressTotalToken);
            document.getElementById("addressTotalToken").innerText = '보유 주식 수 :' + addressTotalToken;
        } catch (err) {
            document.getElementById("addressTotalToken").innerText = err;
        }
    }

    function addStocks() {
        try {
            console.log("from", "<임의의 주소>");
            console.log("to", "<임의의 주소>");
            var stock = vc.addStocks("<임의의 주소>", 10, {value: web3.toWei(5, "ether"), from:"<임의의 주소>"});
            document.getElementById("addStocks").innerText = '결과 :' + stock;
        } catch (err) {
            document.getElementById("addStocks").innerText = err;
        }
    }

    function getCABalance() {
        try {
            console.log("CA", "<임의의 주소>");
            var stock = web3.eth.getBalance("<임의의 주소>");
            var stock = web3.toWei(stock, "ether");
            document.getElementById("getCABalance").innerText = '결과 :' + stock;
        } catch (err) {
            document.getElementById("getCABalance").innerText = err;
        }
    }
    
</script>

</head>

<body>
    <h1>KISA Corp.</h1>
    <p>
        <span id="getTotalNumberOfIssues">Loading...</span>
    </p>

    <p>
        <button type="button" onClick="getTotalStuck();">getTotalStuck :</button><div id="addressTotalToken"></div><br />
    </p>
    <p>
        <button type="button" onClick="addStocks();">addStocks :</button><div id="addStocks"></div><br />
    </p>
    <p>
        <button type="button" onClick="getCABalance();">getCABalance :</button><div id="getCABalance"></div><br />
    </p>
</body>
</html>